<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{camera_name}} - Configuration</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <h1><span class="status online" id="status"></span> {{camera_name}}</h1>
        
        <div class="grid">
            <div>
                <div class="card preview" id="preview-container">
                    <iframe id="preview-iframe" src="{{preview_url}}" data-main-stream="{{main_stream_name}}" data-sub-stream="{{sub_stream_name}}" data-api-url="{{webrtc_url}}" allowfullscreen></iframe>
                    <img id="preview-mjpeg" src="" style="display: none; width: 100%; height: 700px; object-fit: contain;" alt="MJPEG Stream">
                    <video id="preview-native-rtc" autoplay playsinline muted style="display: none; width: 100%; height: 700px; object-fit: contain; background: #1a1a2e;"></video>
                </div>
                <div class="preview-toolbar">
                    <div class="stream-switcher">
                        <button class="btn-stream active" data-stream="main" data-type="rtc" onclick="switchStream('main', 'rtc')">Main</button>
                        <button class="btn-stream" data-stream="sub" data-type="rtc" onclick="switchStream('sub', 'rtc')">Sub</button>
                        <button class="btn-stream" data-stream="main" data-type="native_rtc" onclick="switchStream('main', 'native_rtc')" title="Python Native WebRTC (aiortc)">WebRTC</button>
                        <button class="btn-stream" data-stream="mjpeg" data-type="mjpeg" onclick="switchStream('mjpeg', 'mjpeg')">MJPEG</button>
                    </div>
                    <div id="stream-mode-indicator" class="stream-mode-indicator"></div>
                </div>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value" id="fps">-</div>
                        <div class="stat-label">FPS</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="frames">-</div>
                        <div class="stat-label">Frames</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="uptime">-</div>
                        <div class="stat-label">Uptime</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="dropped">-</div>
                        <div class="stat-label">Dropped</div>
                    </div>
                </div>
                <div class="ptz-controls">
                    <div class="ptz-pad">
                        <button class="btn-ptz btn-ptz-up" onmousedown="ptzMove(0, 0.5)" onmouseup="ptzStop()" onmouseleave="ptzStop()" title="Tilt Up">‚ñ≤</button>
                        <div class="ptz-pad-row">
                            <button class="btn-ptz" onmousedown="ptzMove(-0.5, 0)" onmouseup="ptzStop()" onmouseleave="ptzStop()" title="Pan Left">‚óÄ</button>
                            <button class="btn-ptz btn-ptz-home" onclick="ptzHome()" title="Home">‚åÇ</button>
                            <button class="btn-ptz" onmousedown="ptzMove(0.5, 0)" onmouseup="ptzStop()" onmouseleave="ptzStop()" title="Pan Right">‚ñ∂</button>
                        </div>
                        <button class="btn-ptz btn-ptz-down" onmousedown="ptzMove(0, -0.5)" onmouseup="ptzStop()" onmouseleave="ptzStop()" title="Tilt Down">‚ñº</button>
                    </div>
                    <div class="zoom-controls">
                        <button class="btn-ptz" onclick="ptzZoom(0.1)" title="Zoom In">+</button>
                        <div class="zoom-slider-wrapper">
                            <div class="zoom-slider-track"></div>
                            <input type="range" id="zoom-slider" min="0" max="100" value="30" oninput="ptzZoomTo(this.value)">
                        </div>
                        <button class="btn-ptz" onclick="ptzZoom(-0.1)" title="Zoom Out">‚àí</button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="source-info">
                    <div class="source-icon" id="source-icon">{{source_icon}}</div>
                    <div class="source-details">
                        <div class="source-type">{{source_type_label}}</div>
                        <div class="source-name" title="{{source_info}}" id="source-name">{{source_info}}</div>
                    </div>
                </div>
                
                <!-- Video Upload Section (shown only for video_file source type) -->
                <div id="video-upload-section" class="video-upload-section" style="display: none;">
                    <h2>Upload Video</h2>
                    <div class="upload-zone" id="upload-zone">
                        <div class="upload-icon">üìÅ</div>
                        <div class="upload-text">Drop video file here or click to browse</div>
                        <div class="upload-hint">Supported: MP4, AVI, MKV, MOV, WebM</div>
                        <input type="file" id="video-file-input" accept=".mp4,.avi,.mkv,.mov,.wmv,.flv,.webm,.m4v,.mpeg,.mpg,.3gp" style="display: none;">
                    </div>
                    <div id="upload-progress" class="upload-progress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <div class="progress-text" id="progress-text">Uploading...</div>
                    </div>
                    <div id="upload-error" class="upload-error" style="display: none;"></div>
                    <div id="upload-success" class="upload-success" style="display: none;"></div>
                </div>
                
                <h2>Stream URLs</h2>
                <div class="url-list">
                    <div><span>Main RTSP:</span> <a href="{{main_rtsp}}" target="_blank">{{main_rtsp}}</a></div>
                    <div><span>Sub RTSP:</span> <a href="{{sub_rtsp}}" target="_blank">{{sub_rtsp}}</a></div>
                    <div><span>ONVIF:</span> <a href="{{onvif_url}}" target="_blank">{{onvif_url}}</a></div>
                    <div><span>WebRTC:</span> <a href="{{webrtc_url}}" target="_blank">{{webrtc_url}}</a></div>
                    <div><span>MJPEG:</span> <a href="{{mjpeg_url}}" target="_blank" id="mjpeg-url">{{mjpeg_url}}</a></div>
                </div>
                
                <h2>Main Stream</h2>
                <div class="inline">
                    <div class="form-group">
                        <label>Resolution</label>
                        <select id="main_res">
                            <option value="1920x1080">1920x1080</option>
                            <option value="1280x720">1280x720</option>
                            <option value="640x480">640x480</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>FPS</label>
                        <select id="main_fps">
                            <option value="60">60</option>
                            <option value="30">30</option>
                            <option value="15">15</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Bitrate</label>
                    <select id="main_bitrate">
                        <option value="8M">8 Mbps</option>
                        <option value="4M">4 Mbps</option>
                        <option value="2M">2 Mbps</option>
                        <option value="1M">1 Mbps</option>
                    </select>
                </div>
                
                <h2>Sub Stream</h2>
                <div class="inline">
                    <div class="form-group">
                        <label>Resolution</label>
                        <select id="sub_res">
                            <option value="640x480">640x480</option>
                            <option value="320x240">320x240</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Bitrate</label>
                        <select id="sub_bitrate">
                            <option value="1M">1 Mbps</option>
                            <option value="512K">512 Kbps</option>
                        </select>
                    </div>
                </div>
                
                <h2>Encoder</h2>
                <div class="form-group">
                    <label>Hardware Acceleration</label>
                    <select id="hw_accel">
                        <option value="auto">Auto</option>
                        <option value="nvenc">NVENC (NVIDIA)</option>
                        <option value="qsv">QSV (Intel)</option>
                        <option value="cpu">CPU</option>
                    </select>
                </div>
                
                <h2>Overlay</h2>
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="show_timestamp" checked>
                        <span>Show Timestamp</span>
                    </label>
                </div>
                <div class="form-group">
                    <label>Position</label>
                    <select id="timestamp_position">
                        <option value="bottom-left">Bottom Left</option>
                        <option value="bottom-right">Bottom Right</option>
                        <option value="top-left">Top Left</option>
                        <option value="top-right">Top Right</option>
                    </select>
                </div>
                
                <button class="btn" onclick="applyConfig()">Apply Changes</button>
                <span id="apply-status" style="margin-left: 10px; color: #888;"></span>
            </div>
        </div>
        
        <footer class="footer">
            <div class="footer-content">
                <span>IPyCam v{{version}}</span>
                <span class="footer-separator">‚Ä¢</span>
                <a href="https://github.com/olkham/IPyCam" target="_blank" rel="noopener">GitHub</a>
            </div>
        </footer>
    </div>
    
    <script src="/static/js/app.js"></script>
</body>
</html>
